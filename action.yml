name: emulate
description: Emulate unsupported operating systems using QEMU.
inputs:
  operating-system:
    description: The operating-system specifier.
    required: true
runs:
  using: composite
  steps:
  - name: Setup QEMU and the guest OS virtual machine.
    shell: bash
    env:
      GUEST_OS: ${{ inputs.operating-system }}
    run: |
      sudo apt-get -qq install --no-install-recommends vagrant vagrant-libvirt libvirt-daemon libvirt-daemon-system qemu-kvm qemu-utils libstring-shellquote-perl
      sudo systemctl --quiet start libvirtd.service
      cd "$GITHUB_ACTION_PATH/$GUEST_OS" && sudo vagrant up
      sudo ln --force "$GITHUB_ACTION_PATH/shell" /bin/bash
